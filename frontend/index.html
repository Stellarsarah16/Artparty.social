<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>StellarArtCollab - Collaborative Pixel Art</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="apple-touch-icon" href="favicon.svg">
    
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/admin.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Modal Fix - Ensure modals display correctly */
        .modal {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            background: rgba(0, 0, 0, 0.8) !important;
            z-index: 999999 !important;
            display: none !important;
            justify-content: center !important;
            align-items: center !important;
        }

        .modal[style*="flex"], 
        .modal.active {
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        .modal-content {
            background: white !important;
            border-radius: 8px !important;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3) !important;
            max-width: 500px !important;
            width: 90% !important;
            max-height: 90vh !important;
            overflow-y: auto !important;
            position: relative !important;
            transform: none !important;
            margin: auto !important;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Loading Artparty.Social...</p>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <i class="fas fa-palette"></i>
                <span>Artparty.Social</span>
            </div>
            <div class="nav-menu" id="nav-menu">
                <div class="nav-item">
                    <button class="nav-link btn-primary" id="login-btn">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </div>
                <div class="nav-item">
                    <button class="nav-link btn-secondary" id="register-btn">
                        <i class="fas fa-user-plus"></i> Register
                    </button>
                </div>
                <div class="nav-item user-info hidden" id="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <span class="username" id="username"></span>
                    <div class="user-dropdown">
                        <button class="dropdown-btn" id="admin-btn" style="display: none;">
                            <i class="fas fa-shield-alt"></i> Admin Panel
                        </button>
                        <button class="dropdown-btn" id="profile-btn">
                            <i class="fas fa-user-cog"></i> Profile
                        </button>
                        <button class="dropdown-btn" id="logout-btn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        
        <!-- Welcome Section -->
        <section class="welcome-section" id="welcome-section">
            <div class="welcome-container">
                <h1>Welcome to Artparty.Social</h1>
                <p>Create, share, and collaborate on pixel art in real-time with artists around the world.</p>
                <div class="feature-grid">
                    <div class="feature-card">
                        <i class="fas fa-paint-brush"></i>
                        <h3>32x32 Pixel Art</h3>
                        <p>Create detailed pixel art with our intuitive editor</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-users"></i>
                        <h3>Real-time Collaboration</h3>
                        <p>See other artists' work appear instantly on shared canvases</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-heart"></i>
                        <h3>Positive Community</h3>
                        <p>Support fellow artists with our like-only feedback system</p>
                    </div>
                </div>
                <div class="welcome-actions">
                    <button class="btn btn-primary btn-large" id="get-started-btn">
                        <i class="fas fa-rocket"></i> Get Started
                    </button>
                </div>
            </div>
        </section>

        <!-- Canvas Selection -->
        <section class="canvas-section hidden" id="canvas-section">
            <div class="section-header">
                <h2>Choose a Canvas</h2>
                <div class="section-actions">
                    <button class="btn btn-primary" id="create-canvas-btn">
                        <i class="fas fa-plus"></i> Create Canvas
                    </button>
                    <button class="btn btn-secondary" id="refresh-canvases-btn">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                </div>
            </div>
            <div class="canvas-grid" id="canvas-grid">
                <!-- Canvas cards will be dynamically inserted here -->
            </div>
        </section>

        <!-- Canvas Viewer -->
        <section class="viewer-section hidden" id="viewer-section">
            <!-- Modern Stats Bar -->
            <div class="canvas-stats-bar">
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-th"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="viewer-total-tiles">0</div>
                            <div class="stat-label">Total Tiles</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="viewer-active-users">0</div>
                            <div class="stat-label">Active Users</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-paintbrush"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="viewer-user-tiles">0</div>
                            <div class="stat-label">Your Tiles</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="viewer-header">
                <div class="viewer-title">
                    <h2 id="viewer-canvas-title">Canvas Name</h2>
                    <div class="canvas-info">
                        <span id="viewer-canvas-users">0 users online</span>
                        <span id="viewer-canvas-dimensions">32x32</span>
                        <span id="viewer-instructions">Click on a tile to edit it</span>
                    </div>
                </div>
                <div class="viewer-actions">
                    <button class="btn btn-secondary" id="viewer-back-to-canvases-btn">
                        <i class="fas fa-arrow-left"></i> Back to Canvases
                    </button>
                    <button class="btn btn-secondary" id="viewer-refresh-btn">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                    <button class="btn btn-secondary" id="viewer-settings-btn">
                        <i class="fas fa-cog"></i> Canvas Settings
                    </button>
                    <button class="btn btn-primary" id="viewer-zoom-fit-btn">
                        <i class="fas fa-expand"></i> Fit to Screen
                    </button>
                </div>
            </div>
            
            <div class="viewer-layout">
                <!-- Main Canvas Viewer -->
                <div class="viewer-main">
                    <div class="canvas-viewer-container">
                        <canvas id="canvas-viewer" width="800" height="600"></canvas>
                        <div class="viewer-overlay">
                            <div class="zoom-indicator" id="viewer-zoom-level">100%</div>
                            <div class="tile-info" id="viewer-tile-info">
                                Hover over tiles to see details
                            </div>
                        </div>
                    </div>
                    
                    <div class="viewer-controls">
                        <div class="zoom-controls">
                            <button class="btn btn-sm" id="viewer-zoom-out-btn">
                                <i class="fas fa-search-minus"></i>
                            </button>
                            <span id="viewer-zoom-display">100%</span>
                            <button class="btn btn-sm" id="viewer-zoom-in-btn">
                                <i class="fas fa-search-plus"></i>
                            </button>
                        </div>
                        <div class="view-options">
                            <button class="btn btn-sm" id="toggle-grid-btn" title="Toggle Grid">
                                <i class="fas fa-th"></i>
                            </button>
                            <button class="btn btn-sm" id="toggle-user-indicators-btn" title="Toggle User Names">
                                <i class="fas fa-user"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Sidebar Info (simplified - only online users) -->
                <div class="viewer-sidebar">
                    <div class="online-users">
                        <h4>Online Users</h4>
                        <div class="user-list" id="viewer-users-list">
                            <!-- Online users will be shown here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Bottom Info Section (mobile responsive) -->
            <div class="viewer-bottom-info">
                <div class="bottom-info-container">
                    <div class="info-card">
                        <div class="info-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="info-content">
                            <div class="info-value" id="bottom-canvas-users">0 users online</div>
                            <div class="info-label">Online</div>
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-icon">
                            <i class="fas fa-expand-arrows-alt"></i>
                        </div>
                        <div class="info-content">
                            <div class="info-value" id="bottom-canvas-dimensions">32x32</div>
                            <div class="info-label">Canvas Size</div>
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-icon">
                            <i class="fas fa-mouse-pointer"></i>
                        </div>
                        <div class="info-content">
                            <div class="info-value">Tap to Edit</div>
                            <div class="info-label">Instructions</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Editor Section -->
        <section class="editor-section hidden" id="editor-section">
            <!-- Floating Tools Panel -->
            <div class="floating-tools-panel" id="floating-tools-panel">
                <div class="tools-row">
                    <!-- FIXED: Back button on left -->
                    <div class="floating-action-left">
                        <button class="btn btn-secondary" id="floating-back-btn">
                            <i class="fas fa-arrow-left"></i> Back
                        </button>
                    </div>
                    
                    <!-- FIXED: Middle section for stacked tools and colors -->
                    <div class="floating-tools-middle">
                        <div class="tools-section">
                            <h3>Tools</h3>
                            <div class="tool-group">
                                <button class="tool-btn active" id="paint-tool" title="Paint">
                                    <i class="fas fa-paintbrush"></i>
                                </button>
                                <button class="tool-btn" id="eraser-tool" title="Eraser">
                                    <i class="fas fa-eraser"></i>
                                </button>
                                <button class="tool-btn" id="picker-tool" title="Color Picker">
                                    <i class="fas fa-eye-dropper"></i>
                                </button>
                                <button class="tool-btn" id="fill-tool" title="Fill">
                                    <i class="fas fa-fill-drip"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="color-palette">
                            <h4>Colors</h4>
                            <div class="color-grid" id="color-palette">
                                <!-- Color squares will be generated by JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- FIXED: Save button on right -->
                    <div class="floating-action-right">
                        <button class="btn btn-primary" id="floating-save-btn" disabled>
                            <i class="fas fa-save"></i> Save
                        </button>
                    </div>
                </div>
            </div>

            <div class="editor-header">
                <div class="editor-header-content">
                    <div class="editor-title">
                        <h2 id="canvas-title">Canvas Name</h2>
                        <div class="canvas-info">
                            <span id="canvas-users">0 users online</span>
                            <span id="canvas-dimensions">32x32</span>
                            <span id="current-tile-coords" style="color: #4CAF50; font-weight: bold;">No tile selected</span>
                            <span id="tile-info-owner">Owner: -</span>
                            <span id="tile-info-canvas">Canvas: -</span>
                            <span id="tile-info-created">Created: -</span>
                            <span id="tile-info-updated">Updated: -</span>
                        </div>
                    </div>
                    <div class="editor-actions">
                        <!-- FIXED: Hide old buttons since we have floating tools panel -->
                        <button class="btn btn-secondary" id="back-to-canvases-btn" style="display: none;">
                            <i class="fas fa-arrow-left"></i> Back to Canvases
                        </button>
                        <button class="btn btn-secondary" id="back-to-grid-btn" style="display: none;">
                            <i class="fas fa-th"></i> Back to Grid View
                        </button>
                        <button class="btn btn-secondary" id="undo-btn" title="Undo Last Save (Ctrl+Z)" style="display: none;">
                            <i class="fas fa-undo"></i> Undo Last Save
                        </button>
                        <button class="btn btn-secondary" id="redo-btn" title="Redo (Ctrl+Shift+Z)" style="display: none;">
                            <i class="fas fa-redo"></i> Redo
                        </button>
                        <button class="btn btn-primary" id="save-tile-btn" disabled style="display: none;">
                            <i class="fas fa-save"></i> Save Tile
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="editor-layout">
                <!-- Pixel Art Editor with Integrated Neighbors -->
                <div class="editor-panel">
                    <!-- Integrated Canvas with Neighbors -->
                    <div class="integrated-canvas-container">
                        <!-- Top row with diagonal neighbors -->
                        <div class="neighbor-row">
                            <div class="neighbor-cell empty" id="neighbor-top-left">
                                <div class="neighbor-label">Top-Left</div>
                                <canvas class="neighbor-canvas" width="512" height="512" id="neighbor-top-left-canvas"></canvas>
                            </div>
                            <div class="neighbor-cell empty" id="neighbor-top">
                                <div class="neighbor-label">Top</div>
                                <canvas class="neighbor-canvas" width="512" height="512" id="neighbor-top-canvas"></canvas>
                            </div>
                            <div class="neighbor-cell empty" id="neighbor-top-right">
                                <div class="neighbor-label">Top-Right</div>
                                <canvas class="neighbor-canvas" width="512" height="512" id="neighbor-top-right-canvas"></canvas>
                            </div>
                        </div>
                        <!-- Middle row with main canvas -->
                        <div class="neighbor-row">
                            <div class="neighbor-cell empty" id="neighbor-left">
                                <div class="neighbor-label">Left</div>
                                <canvas class="neighbor-canvas" width="512" height="512" id="neighbor-left-canvas"></canvas>
                            </div>
                            <div class="main-canvas-container">
                                <div class="canvas-label">Current Tile</div>
                                <canvas id="pixel-canvas" width="512" height="512"></canvas>
                                <div class="canvas-overlay">
                                    <div class="position-indicator" id="position-indicator">
                                        Position: (0, 0)
                                    </div>
                                </div>
                            </div>
                            <div class="neighbor-cell empty" id="neighbor-right">
                                <div class="neighbor-label">Right</div>
                                <canvas class="neighbor-canvas" width="512" height="512" id="neighbor-right-canvas"></canvas>
                            </div>
                        </div>
                        <!-- Bottom row with diagonal neighbors -->
                        <div class="neighbor-row">
                            <div class="neighbor-cell empty" id="neighbor-bottom-left">
                                <div class="neighbor-label">Bottom-Left</div>
                                <canvas class="neighbor-canvas" width="512" height="512" id="neighbor-bottom-left-canvas"></canvas>
                            </div>
                            <div class="neighbor-cell empty" id="neighbor-bottom">
                                <div class="neighbor-label">Bottom</div>
                                <canvas class="neighbor-canvas" width="512" height="512" id="neighbor-bottom-canvas"></canvas>
                            </div>
                            <div class="neighbor-cell empty" id="neighbor-bottom-right">
                                <div class="neighbor-label">Bottom-Right</div>
                                <canvas class="neighbor-canvas" width="512" height="512" id="neighbor-bottom-right-canvas"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tile Gallery -->
        <section class="gallery-section hidden" id="gallery-section">
            <div class="section-header">
                <h2>Your Tiles</h2>
                <div class="gallery-filters">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="liked">Most Liked</button>
                    <button class="filter-btn" data-filter="recent">Recent</button>
                </div>
            </div>
            <div class="tile-grid" id="tile-grid">
                <!-- Tile cards will be dynamically inserted here -->
            </div>
        </section>

        <!-- Admin Panel -->
        <section class="admin-section hidden" id="admin-section">
            <div class="admin-container">
                <div class="admin-header">
                    <h1>🔧 Admin Panel</h1>
                    <div class="admin-nav">
                        <button id="admin-dashboard-tab" class="admin-tab active">Dashboard</button>
                        <button id="admin-users-tab" class="admin-tab">Users</button>
                        <button id="admin-locks-tab" class="admin-tab">Tile Locks</button>
                    </div>
                </div>
                
                <div class="admin-main">
                    <div id="admin-dashboard-view" class="admin-view">
                        <div class="admin-loading">Loading dashboard...</div>
                    </div>
                    
                    <div id="admin-users-view" class="admin-view" style="display: none;">
                        <div class="admin-loading">Loading users...</div>
                    </div>
                    
                    <div id="admin-locks-view" class="admin-view" style="display: none;">
                        <div class="admin-loading">Loading locks...</div>
                    </div>

                    <!-- In the admin-canvases-view section -->
                    <div id="admin-canvases-view" class="admin-view" style="display: none;">
                        <div class="admin-loading">Loading canvases...</div>
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Dimensions</th>
                                    <th>Tile Size & Grid</th>
                                    <th>Settings</th>
                                    <th>Status</th>
                                    <th>Max Tiles/User</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="canvases-tbody">
                                <!-- Canvas data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-section">
                <div class="footer-brand">
                    <h3>Artparty.social</h3>
                    <p>Collaborative pixel art creation platform
                        <br>Brought to you by Stellar Creations
                    </p>
                </div>
            </div>
            <div class="footer-section">
                <h4>Legal</h4>
                <ul class="footer-links">
                    <li><a href="#" onclick="showLegalPage('terms')">Terms of Service</a></li>
                    <li><a href="#" onclick="showLegalPage('privacy')">Privacy Policy</a></li>
                    <li><a href="#" onclick="showLegalPage('dmca')">DMCA Policy</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Support</h4>
                <ul class="footer-links">
                    <li><a href="mailto:support@artparty.social">Contact Support</a></li>
                    <li><a href="#" onclick="showLegalPage('about')">About</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <div class="footer-copyright">
                    <p>&copy; 2025 Artparty.social. All rights reserved.</p>
                    <p>Made with ❤️ for creative communities</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Legal Pages Modal -->
    <div class="modal" id="legal-modal">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h2 id="legal-modal-title">Legal Information</h2>
                <button class="modal-close" onclick="hideLegalModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="legal-content">
                    <!-- Legal content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    
    <!-- Login Modal -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Login</h3>
                <button class="close-btn" id="close-login-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-username">Username</label>
                    <input type="text" id="login-username" name="username" autocomplete="username" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" name="password" autocomplete="current-password" required>
                </div>
                <button type="submit" class="btn btn-primary btn-full">Login</button>
                <div class="form-links">
                    <a href="#" id="open-password-reset">Forgot password?</a>
                    <a href="#" id="open-email-verification">Resend verification email?</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal" id="register-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Register</h3>
                <button class="close-btn" id="close-register-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="register-form">
                <div class="form-group">
                    <label for="register-username">Username</label>
                    <input type="text" id="register-username" name="username" autocomplete="username" required>
                </div>
                <div class="form-group">
                    <label for="register-email">Email</label>
                    <input type="email" id="register-email" name="email" autocomplete="email" required>
                </div>
                <div class="form-group">
                    <label for="register-first-name">First Name</label>
                    <input type="text" id="register-first-name" name="first_name" autocomplete="given-name" required>
                </div>
                <div class="form-group">
                    <label for="register-last-name">Last Name</label>
                    <input type="text" id="register-last-name" name="last_name" autocomplete="family-name" required>
                </div>
                <div class="form-group">
                    <label for="register-password">Password</label>
                    <input type="password" id="register-password" name="password" autocomplete="new-password" required>
                </div>
                <div class="form-group">
                    <label for="register-confirm-password">Confirm Password</label>
                    <input type="password" id="register-confirm-password" name="confirm_password" autocomplete="new-password" required>
                </div>
                <button type="submit" class="btn btn-primary btn-full">Register</button>
                <div class="form-links">
                    <a href="#" id="open-email-verification-from-register">Verify your email</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Canvas Modal -->
    <div class="modal" id="create-canvas-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Canvas</h3>
                <button class="close-btn" id="close-create-canvas-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="create-canvas-form">
                <div class="form-group">
                    <label for="canvas-name">Canvas Name</label>
                    <input type="text" id="canvas-name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="canvas-description">Description</label>
                    <textarea id="canvas-description" name="description" rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="canvas-width">Width</label>
                        <select id="canvas-width" name="width">
                            <option value="1024">1024px</option>
                            <option value="2048">2048px</option>
                            <option value="4096">4096px</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="canvas-height">Height</label>
                        <select id="canvas-height" name="height">
                            <option value="1024">1024px</option>
                            <option value="2048">2048px</option>
                            <option value="4096">4096px</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="tile-size">Tile Size</label>
                    <select id="tile-size" name="tile_size">
                        <option value="32">32x32px (Small - 32 tiles)</option>
                        <option value="64" selected>64x64px (Medium - 16 tiles)</option>
                        <option value="128">128x128px (Large - 8 tiles)</option>
                        <option value="256">256x256px (Extra Large - 4 tiles)</option>
                        <option value="512">512x512px (Huge - 2 tiles)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="max-tiles">Max Tiles per User</label>
                    <input type="number" id="max-tiles" name="max_tiles_per_user" min="1" max="100" value="10">
                </div>
                <div class="form-group">
                    <label for="canvas-palette">Color Palette</label>
                    <select id="canvas-palette" name="palette_type" required>
                        <option value="classic">Classic - Basic RGB colors</option>
                        <option value="earth">Earth - Van Gogh inspired earth tones</option>
                        <option value="pastel">Pastel - Monet inspired soft colors</option>
                        <option value="neon">Neon - 80s Synthwave electric colors</option>
                        <option value="monochrome">Monochrome - Ansel Adams grayscale</option>
                        <option value="retro">Retro - Wes Anderson vintage charm</option>
                        <option value="artistic">Artistic - Professional art palette</option>
                        <option value="sunset">Sunset - Turner inspired warm colors</option>
                        <option value="ocean">Ocean - Hokusai inspired sea colors</option>
                        <option value="forest">Forest - Rousseau inspired nature tones</option>
                        <option value="cyberpunk">Cyberpunk - Blade Runner futuristic</option>
                        <option value="vintage">Vintage - Edward Hopper Americana</option>
                        <option value="desert">Desert - Georgia O'Keeffe landscapes</option>
                        <option value="grapevine">Grapevine - Klimt jewel tones</option>
                        <option value="midnightSky">Midnight Sky - Rothko contemplative</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="collaboration-mode">Collaboration Mode</label>
                    <select id="collaboration-mode" name="collaboration_mode">
                        <option value="free">Free - Anyone can edit anywhere</option>
                        <option value="tile-lock">Tile Lock - One user per tile at a time</option>
                        <option value="area-lock">Area Lock - Locked areas for focused work</option>
                        <option value="review">Review - Changes require approval</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="auto-save-interval">Auto-Save Interval</label>
                    <select id="auto-save-interval" name="auto_save_interval">
                        <option value="30">30 seconds</option>
                        <option value="60" selected>1 minute</option>
                        <option value="300">5 minutes</option>
                        <option value="600">10 minutes</option>
                        <option value="0">Manual only</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="canvas-public" name="is_public" checked>
                        Make this canvas public
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="canvas-moderated" name="is_moderated">
                        Enable moderation (review changes before they go live)
                    </label>
                </div>
                <button type="submit" class="btn btn-primary btn-full">Create Canvas</button>
            </form>
        </div>
    </div>

    <!-- Email Verification Modal -->
    <div class="modal" id="email-verification-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-envelope"></i> Email Verification</h3>
                <button class="modal-close" id="close-email-verification-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="verification-step" id="verification-request-step">
                    <p>Enter your email address to receive a verification link:</p>
                    <form id="email-verification-form">
                        <div class="form-group">
                            <label for="verification-email">Email Address</label>
                            <input type="email" id="verification-email" name="email" required>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> Send Verification Email
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="verification-step hidden" id="verification-confirm-step">
                    <p>Enter the verification code from your email:</p>
                    <form id="email-confirmation-form">
                        <div class="form-group">
                            <label for="verification-token">Verification Code</label>
                            <input type="text" id="verification-token" name="token" required 
                                   placeholder="Enter the code from your email">
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-check"></i> Verify Email
                            </button>
                            <button type="button" class="btn btn-secondary" id="resend-verification">
                                <i class="fas fa-redo"></i> Resend Code
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="verification-step hidden" id="verification-success-step">
                    <div class="success-message">
                        <i class="fas fa-check-circle"></i>
                        <h4>Email Verified Successfully!</h4>
                        <p>Your email has been verified. You can now log in to your account.</p>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-primary" id="go-to-login">
                            <i class="fas fa-sign-in-alt"></i> Go to Login
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Password Reset Modal -->
    <div class="modal" id="password-reset-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-unlock-alt"></i> Password Reset</h3>
                <button class="modal-close" id="close-password-reset-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="reset-step" id="reset-request-step">
                    <p>Enter your email address to receive a password reset link:</p>
                    <form id="password-reset-request-form">
                        <div class="form-group">
                            <label for="reset-email">Email Address</label>
                            <input type="email" id="reset-email" name="email" required>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> Send Reset Email
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="reset-step hidden" id="reset-confirm-step">
                    <p>Enter the reset code from your email and your new password:</p>
                    <form id="password-reset-confirm-form">
                        <div class="form-group">
                            <label for="reset-token">Reset Code</label>
                            <input type="text" id="reset-token" name="token" required 
                                   placeholder="Enter the code from your email">
                        </div>
                        <div class="form-group">
                            <label for="new-password">New Password</label>
                            <input type="password" id="new-password" name="new_password" required>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-check"></i> Reset Password
                            </button>
                            <button type="button" class="btn btn-secondary" id="resend-reset">
                                <i class="fas fa-redo"></i> Resend Code
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="reset-step hidden" id="reset-success-step">
                    <div class="success-message">
                        <i class="fas fa-check-circle"></i>
                        <h4>Password Reset Successfully!</h4>
                        <p>Your password has been updated. You can now log in with your new password.</p>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-primary" id="go-to-login-from-reset">
                            <i class="fas fa-sign-in-alt"></i> Go to Login
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div class="toast" id="toast">
        <div class="toast-content">
            <i class="toast-icon"></i>
            <span class="toast-message"></span>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Console Manager - Must load first to control logging! -->
    <script src="js/console-manager.js"></script>
    
    <!-- Smart Logger - Load after console manager for intelligent logging -->
    <script src="js/smart-logger.js"></script>
    
    <!-- HTTPS Enforcer - Must load third! -->
    <script src="js/https-enforcer.js"></script>
    
    <script>
        // Cache busting for critical files
        const cacheBuster = '?v=1.2.0&t=' + Date.now();
        console.log('🔧 Cache buster generated:', cacheBuster);
        
        // Dynamically load scripts with cache busting
        const scripts = [
            'js/config.js',
            'js/api.js',
            'js/canvas-viewer.js',
            'js/pixel-editor.js',
            'js/websocket.js',
            'js/ui.js',
            'js/form-validation.js',
            'js/neighbor-display.js'
        ];
        
        const modules = [
            'js/services/auth.js',
            'js/services/canvas.js',
            'js/modules/managers/index.js',
            'js/modules/auth.js',
            'js/modules/navigation.js',
            'js/modules/app-state.js',
            'js/app.js'
        ];
        
        // Load auth verification script
        const authVerificationScript = document.createElement('script');
        authVerificationScript.src = 'js/auth-verification.js' + cacheBuster;
        document.head.appendChild(authVerificationScript);
        
        // Load legal pages script
        const legalScript = document.createElement('script');
        legalScript.src = 'js/legal.js' + cacheBuster;
        document.head.appendChild(legalScript);
        
        // Load regular scripts first (synchronously)
        const loadScripts = async () => {
            for (const src of scripts) {
                const script = document.createElement('script');
                script.src = src + cacheBuster;
                document.head.appendChild(script);
                
                // Wait for script to load
                await new Promise((resolve, reject) => {
                    script.onload = resolve;
                    script.onerror = reject;
                });
            }
            
            // Wait a bit for scripts to initialize
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Load module scripts
            modules.forEach(src => {
                const script = document.createElement('script');
                script.type = 'module';
                script.src = src + cacheBuster;
                document.head.appendChild(script);
            });
        };
        
        loadScripts().catch(error => {
            console.error('❌ Failed to load scripts:', error);
        });
    </script>
</body>
</html> 